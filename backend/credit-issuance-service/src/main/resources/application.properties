# Application name for Eureka service registration
spring.application.name=CREDIT-SERVICE

# Server port
server.port=${SERVER_PORT:8085}

# ============================================
# Spring Cloud Config Server Configuration
# ============================================
spring.cloud.config.uri=${CONFIG_SERVER_URI:http://localhost:8888}
spring.cloud.config.fail-fast=true
spring.cloud.config.retry.max-attempts=6
spring.cloud.config.retry.initial-interval=1000

# ============================================
# Eureka Client Configuration
# ============================================
eureka.client.service-url.defaultZone=${EUREKA_URI:http://localhost:8761/eureka/}
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=10

# ============================================
# PostgreSQL Database Configuration
# ============================================
# Database connection (Neon-compatible with SSL)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/creditdb}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool settings
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hik ari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# SSL for Neon PostgreSQL
spring.datasource.hikari.data-source-properties.ssl=true
spring.datasource.hikari.data-source-properties.sslmode=${DB_SSL_MODE:require}

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ============================================
# Kafka Configuration
# ============================================
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Consumer Configuration (for EMISSION_VERIFIED events)
spring.kafka.consumer.group-id=credit-service-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=com.carboncredit.common.event
spring.kafka.consumer.properties.isolation.level=read_committed

# Kafka Producer Configuration (for CREDIT_ISSUED and CREDIT_ISSUANCE_FAILED events)
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5

# Kafka Topic Names
kafka.topic.emission-verified=EMISSION_VERIFIED
kafka.topic.credit-issued=CREDIT_ISSUED
kafka.topic.credit-issuance-failed=CREDIT_ISSUANCE_FAILED

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.com.carboncredit.creditservice=DEBUG
logging.level.org.springframework.kafka=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================
# Actuator Configuration (for health checks)
# ============================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ============================================
# Business Configuration
# ============================================
# Credit calculation rule: 1 credit per 1 ton CO2
credit.calculation.ratio=1.0
