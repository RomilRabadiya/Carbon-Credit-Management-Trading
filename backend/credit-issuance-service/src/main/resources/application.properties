# Application name for Eureka service registration
spring.application.name=credit-issuance-service

# Server port
server.port=${SERVER_PORT:8085}

# ============================================
# Spring Cloud Config Server Configuration
# ============================================
spring.cloud.config.enabled=false
# spring.cloud.config.uri=${CONFIG_SERVER_URI:http://localhost:8888}
# spring.cloud.config.fail-fast=true

# ============================================
# Eureka Client Configuration
# ============================================
eureka.client.service-url.defaultZone=${EUREKA_URI:http://localhost:8761/eureka/}
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=10

# ============================================
# PostgreSQL Database Configuration
# ============================================
# NeonDB Database Configuration
spring.datasource.url=jdbc:postgresql://ep-cold-fog-a13rf1hh-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require&channelBinding=require
spring.datasource.username=neondb_owner
spring.datasource.password=npg_zie8fp2IGWkO
spring.datasource.driverClassName=org.postgresql.Driver
spring.datasource.hikari.data-source-properties.ssl=true
spring.datasource.hikari.data-source-properties.sslmode=require

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.default_schema=credit_issuance
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ============================================
# Resource Server Configuration
# Resource Server Configuration
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${SUPABASE_URL}/auth/v1/jwks

# Kafka Configuration
# ============================================
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Consumer Configuration (for EMISSION_VERIFIED events)
spring.kafka.consumer.group-id=credit-service-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=com.carboncredit.common.event
spring.kafka.consumer.properties.isolation.level=read_committed

# Kafka Producer Configuration (for CREDIT_ISSUED and CREDIT_ISSUANCE_FAILED events)
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5

# Kafka Topic Names
kafka.topic.emission-verified=EMISSION_VERIFIED
kafka.topic.credit-issued=CREDIT_ISSUED
kafka.topic.credit-issuance-failed=CREDIT_ISSUANCE_FAILED

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.com.carboncredit.creditservice=DEBUG
logging.level.org.springframework.kafka=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================
# Actuator Configuration (for health checks)
# ============================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ============================================
# Business Configuration
# ============================================
# Credit calculation rule: 1 credit per 1 ton CO2
credit.calculation.ratio=1.0
